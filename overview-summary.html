<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--NewPage-->
<HTML>
<HEAD>
<!-- Generated by javadoc (build 1.6.0_29) on Tue Nov 08 04:29:08 PST 2011 -->
<TITLE>
Overview
</TITLE>

<META NAME="date" CONTENT="2011-11-08">

<LINK REL ="stylesheet" TYPE="text/css" HREF="bledocs.css" TITLE="Style">

<SCRIPT type="text/javascript">
function windowTitle()
{
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="Overview";
    }
}
</SCRIPT>
<NOSCRIPT>
</NOSCRIPT>

</HEAD>

<BODY BGCOLOR="white" onload="windowTitle();">
<HR>


<!-- ========= START OF TOP NAVBAR ======= -->
<A NAME="navbar_top"><!-- --></A>
<A HREF="#skip-navbar_top" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_top_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Overview</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="com/broadcom/bt/le/api/package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <FONT CLASS="NavBarFont1">Class</FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="overview-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;PREV&nbsp;
&nbsp;NEXT</FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="index.html?overview-summary.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="overview-summary.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_top"></A>
<!-- ========= END OF TOP NAVBAR ========= -->

<HR>
<div id="overview">
<P>
<B>See:</B>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#overview_description"><B>Description</B></A>
<P>

<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Packages</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="20%"><B><A HREF="com/broadcom/bt/le/api/package-summary.html">com.broadcom.bt.le.api</A></B></TD>
<TD>&nbsp;</TD>
</TR>
</TABLE>

<P>
&nbsp;<A NAME="overview_description"><!-- --></A>
<P>
<div id="overview">
    <h1>Bluetooth Low Energy API</h1>

    <div id="toc-wrapper">
        <div id="toc">
            <h2>Quickview</h2>

            <ul>
                <li>The Open Bluetooth Low Energy APIs add support Low Energy (LE)
                    profiles and devices introduced by the Bluetooth 4.0 specification</li>
            </ul>

            <h2>In this document</h2>
            <ol>
                <li><a href="#Availability">Availability</a></li>
                <li><a href="#ApiOverview">API Overview</a></li>
                <li><a href="#ClassInteraction">API Class Interaction</a><li>
                <li><a href="#AndroidManifest">Android Manifest elements</a></li>
                <li><a href="#SettingUp">Setting Up Bluetooth</a></li>
                <li><a href="#ClientRole">Bluetooth LE client role</li>
                    <ul>
                        <li><a href="#FindingDevices">Finding LE Device</a></li>
                        <li><a href="#ServiceDiscovery">Discovering Services</a></li>
                        <li><a href="#ClientProfile">Connect to a profile/service</a></li>
                        <li><a href="#ClientService">Reading and writing characteristics</a></li>
                    </ul>
                </li>
                <li><a href="#ServerRole">Bluetooth LE server role</li>
                    <ul>
                        <li><a href="#ServerService">Creating LE services</a></li>
                        <li><a href="#ServerProfile">Constructing an LE profile</a></li>
                        <li><a href="#ClientNotifications">Client Notifications</a></li>
                    </ul>
                </li>
            </ol>

            <h2>Key classes</h2>
            <ol>
                <li><a href="com/broadcom/bt/le/api/BleClientProfile.html">BleClientProfile</a></li>
                <li><a href="com/broadcom/bt/le/api/BleClientService.html">BleClientService</a></li>
                <li><a href="com/broadcom/bt/le/api/BleServerProfile.html">BleServerProfile</a></li>
                <li><a href="com/broadcom/bt/le/api/BleServerService.html">BleServerService</a></li>
            </ol>
        </div>
    </div>

    <p>The Bluetooth Specification Version 4.0 introduces Bluetooth Low Energy (LE) devices as well
        as the Generic Attribute Profile (GATT). The Open Bluetooth Low Energy APIs add support
        for Bluetooth Low Energy to the Android platform. These APIs allow applications to enumerate,
        discover and communicate with Low Energy devices and access or provide Low Energy based
        profiles.</p>

    <p>Using the APIs and enhancements made to the Android core operating system, applications can
        perform the following actions:</p>

    <ul>
        <li>Scan for Bluetooth LE devices</li>
        <li>Discover LE profiles and services provided on remote devices</li>
        <li>Access LE based profiles and query remote characteristics</li>
        <li>Create and share LE profiles and services</li>
    </ul>

    <p>Support for Bluetooth Low Energy (BLE) is based around the GATT profile. It defines how
        attributes are grouped together to provide meaningful services. These services contain a
        collection of characteristics that represent query-able and/or writable values as well as
        characteristic information and related permissions.</p>

    <p>Bluetooth Low Energy is an enhancement of the Bluetooth wireless network stack and thus
        requires a device with Bluetooth support.</p>

    <h2 id="Availability">Availability</h2>

    <p>The <code><a href="com/broadcom/bt/le/api/package-summary.html">com.broadcom.bt.le.api</a></code>
        package contains the Low Energy APIs necessary to interact with Low Energy devices. The package
        is provided in a shared library that is pre-installed on devices that support Bluetooth 4.0 and
        the Low Energy profile.</p>

    <p>To create a Bluetooth LE aware application, linking with the Open LE API library is required.
        The Library can be downloaded from
        <a href="http://code.google.com/p/broadcom-ble/">http://code.google.com/p/broadcom-ble/</a>.</p>

    <h2 id="ApiOverview">API Overview</h2>

    <p>The Open Bluetooth Low Energy API includes the following classes provided by the
        <code><a href="com/broadcom/bt/le/api/package-summary.html">com.broadcom.bt.le.api</a></code>
        package:</p>

    <table>
        <tr>
            <th>Class</th>
            <th>Description</th>
        </tr>

        <tr>
            <td><code><a href="http://developer.android.com/reference/android/bluetooth/BluetoothAdapter.html">BluetoothAdapter</a></code></td>
            <td>Represents the local Bluetooth adapter (Bluetooth radio). The
                <code><a href="http://developer.android.com/reference/android/bluetooth/BluetoothAdapter.html">BluetoothAdapter</a></code>
                is the entry-point for all Bluetooth interaction. Using this, you can discover other
                Bluetooth devices, query a list of bonded (paired) devices, instantiate a
                <code><a href="http://developer.android.com/reference/android/bluetooth/BluetoothDevice.html">BluetoothDevice</a></code>
                using a known Bluetooth address, and create a
                <code><a href="http://developer.android.com/reference/android/bluetooth/BluetoothServerSocket.html">BluetoothServerSocket</a></code>
                to listen for communications from other devices.<br />
                <strong>Note:</strong> This function is provided by the Android SDK and only listed here for reference.</td>
        </tr>

        <tr>
            <td><code><a href="http://developer.android.com/reference/android/bluetooth/BluetoothDevice.html">BluetoothDevice</a></code></td>
            <td>Represents a remote Bluetooth device. Use this to request a connection with a remote device through a
                <code><a href="http://developer.android.com/reference/android/bluetooth/BluetoothSocket.html">BluetoothSocket</a></code> or
                query information about the device such as its name, address, class, and bonding state.<br />
                This class has been enhanced to provide the type of the device (BLE, BR/EDR or Dual-mode).<br />
                <strong>Note:</strong> This function is provided by the Android SDK and only listed here for reference.</td>
        </tr>

        <tr>
            <td><code><a href="com/broadcom/bt/le/api/BleClientProfile.html">BleClientProfile</a></code></td>
            <td>Base class used to implement a LE profile for the client role. To access a
                LE profile on a remote device an application must extend this class and supply the necessary
                parameters and services identifying the profile to be accessed. Classes derived from BleClientProfile
                can be used to initiate the connection to a remote device. A
                <code><a href="com/broadcom/bt/le/api/BleClientProfile.html">BleClientProfile</a></code>
                may contain multiple instances of
                <code><a href="com/broadcom/bt/le/api/BleClientService.html">BleClientService</a></code> objects.</td>
        </tr>

        <tr>
            <td><code><a href="com/broadcom/bt/le/api/BleClientService.html">BleClientService</a></code></td>
            <td>This base class may be used to create a derived class representing a LE service on a device action
                in the LE client role. Using this class allows an applicaton to read or write individual
                characteristics of an LE service, as well as registering for notifications when a characteristic
                has changed.</td>
        </tr>

        <tr>
            <td><code><a href="com/broadcom/bt/le/api/BleServerProfile.html">BleServerProfile</a></code></td>
            <td>Represents an abstract base class used to define a LE profile for the server role. To create
                a new LE profile, an application must extend this class and provided the necessary parameters
                identifying the LE profile as well as all required LE services. A class derived from
                <code><a href="com/broadcom/bt/le/api/BleServerProfile.html">BleServerProfile</a></code>
                will contain one or more
                <code><a href="com/broadcom/bt/le/api/BleServerService.html">BleServerService</a></code> objects.</td>
        </tr>

        <tr>
            <td><code><a href="com/broadcom/bt/le/api/BleServerService.html">BleServerService</a></code></td>
            <td>An abstract base class representing an LE service that is part of a LE profile in the server
                role. A class derived from this base class contains one of more
                <code><a href="com/broadcom/bt/le/api/BleCharacteristic.html">BleCharacteristic</a></code> objects
                and provides callbacks and notifications when these characteristics are accessed by a client.</td>
        </tr>

        <tr>
            <td><code><a href="com/broadcom/bt/le/api/BleCharacteristic.html">BleCharacteristic</a></code></td>
            <td>A class used to describe a Bluetooth LE service characteristic. A characteristic contains
                descriptors including the actual value as well as meta data such as the presentation format
                or a human readable description of the value.</td>
        </tr>

        <tr>
            <td><code><a href="com/broadcom/bt/le/api/BleDescriptor.html">BleDescriptor</a></code></td>
            <td>Represents an LE descriptors that can be part of
            <code><a href="com/broadcom/bt/le/api/BleCharacteristic.html">BleCharacteristic</a></code>
            objects.</td>
        </tr>

        <tr>
            <td><code><a href="com/broadcom/bt/le/api/BleGattID.html">BleGattID</a></code></td>
            <td>A utility class used to identify a LE profile, service or characteristic. This class uses
                16-Bit or 128-Bit UUIDs to identify a given LE entity (profile, service or characteristic).</td>
        </tr>

        <tr>
            <td><code><a href="com/broadcom/bt/le/api/BleAdapter.html">BleAdapter</a></code></td>
            <td>Class containing static methods that provided additional information about remote
                Bluetooth devices. It can be used to determine whether a remote device is an
                LE device, classic Bluetooth device (BR/EDR) or a dual-mode device, supporting
                both BR/EDR as well as LE.</td>
        </tr>

        <tr>
            <td><code><a href="com/broadcom/bt/le/api/BleConstants.html">BleConstants</a></code></td>
            <td>A static class containing various GATT related constants used as parameters for various
                LE related functions or to decode their results.</td>
        </tr>
    </table>

    <h2 id="ClassInteraction">API Class Interaction</h2>

    <p>The following chart illustrates typical interaction between the Bluetooth LE API classes.
        The "Battery" LE Profile is used as an example.</p>

    <div id="interaction"><img src="images/ble_classes.png" /></div>

    <h2 id="AndroidManifest">Android Manifest elements</h2>

    <p>To access the Open Bluetooth Low Energy APIs, the following items have to be added to
        the <code>AndroidManifest.xml</code> of your application:</p>

    <ol>
        <li>The permission to use Bluetooth has to be added:
            <pre>&lt;uses-permission android:name="android.permission.BLUETOOTH" /&gt;</pre>
        </li>

        <li>If you want to check the status of Bluetooth and enable it if necessary, also add the
            <a href="http://developer.android.com/reference/android/Manifest.permission.html#BLUETOOTH_ADMIN">BLUETOOTH_ADMIN</a>
            permission (optional):
            <pre>&lt;uses-permission android:name="android.permission.BLUETOOTH_ADMIN" /&gt;</pre>
        </li>

        <li>Finally, add the <code><a href="http://developer.android.com/guide/topics/manifest/uses-library-element.html">&lt;uses-library&gt;</a></code>
            directive to include the Bluetooth LE API library into your application:
            <pre>&lt;uses-library android:name="<em>com.broadcom.bt.le</em>"
              android:required="true" /&gt;</pre>
        </li>
    </ol>

    <p>Adding these elements not only enable your application to access the required APIs, it will
        also be used to filter your application in the Android Market and ensure that your application
        will only be available to devices that support Bluetooth as well as the Low Energy profile.</p>

    <h2 id="SettingUp">Setting Up Bluetooth</h2>

    <p>Before an application can communicate via Bluetooth LE, it should check whether the device
        offers support for Bluetooth and make sure Bluetooth is enabled. If Bluetooth is not supported
        your application may gracefully exit or disable any Bluetooth LE related features.</p>

    <p><a href="http://developer.android.com/guide/topics/wireless/bluetooth.html#SettingUp">Setting up and enabling Bluetooth</a>
        is described in the <a href="http://developer.android.com/guide/topics/wireless/bluetooth.html">Android SDK documentation</a>.</p>

    <h2 id="ClientRole">Bluetooth Low Energy Client Role</h2>

    <p>The Bluetooth GATT profile defines two roles, the client and server roles. A server stores and
        offers attributes while a client accesses them. While a client usually initiates connections
        to the server, Bluetooth LE also offers the capability of a server to notify a client if a
        characteristic or attribute has changed.</p>

    <h3 id="FindingDevices">Finding LE Devices</h3>

    <p>The Android SDK's <code><a href="http://developer.android.com/reference/android/bluetooth/BluetoothAdapter.html">BluetoothAdapter</a></code>
        class can be used to discover Bluetooth devices. On devices supporting the Bluetooth LE profile,
        this class has been enhanced to also report LE devices. More information on how to
        list all paired Bluetooth devices as well as how to discover remote Bluetooth devices can
        be found in the <a href="http://developer.android.com/guide/topics/wireless/bluetooth.html">Android SDK documentation</a>.</p>

    <p>When querying paired devices, or using other Android SDK functions that return
        <code><a href="http://developer.android.com/reference/android/bluetooth/BluetoothDevice.html">BluetoothDevice</a></code>
        objects, the <code><a href="com/broadcom/bt/le/api/BleAdapter.html">BleAdapter</a></code> class
        can be used to determine the type of the device:</p>

     <pre>Set&lt;BluetoothDevice&gt; pairedDevices = mBluetoothAdapter.getBondedDevices();
// If there are paired devices
if (pairedDevices.size() > 0) {
    // Loop through paired devices
    for (BluetoothDevice device : pairedDevices) {
        // Filter LE Only devices
        if (BleAdapter.getDeviceType(device) == BleAdapter.DEVICE_TYPE_BLE)  {
            // Add the name and address to an array adapter to show in a ListView
            mArrayAdapter.add(device.getName() + "\n" + device.getAddress());
        }
    }
}</pre>

    <p>For devices found during Bluetooth device discovery a new field has been added to the
        <code><a href="http://developer.android.com/reference/android/bluetooth/BluetoothDevice.html#ACTION_FOUND">ACTION_FOUND</a></code>
        Intent that is broadcast during device discovery. The
        <code><a href="com/broadcom/bt/le/api/BleAdapter.html#EXTRA_DEVICE_TYPE">EXTRA_DEVICE_TYPE</a></code> field
        indicates the type of the remote device.</p>

    <pre>// Create a BroadcastReceiver for ACTION_FOUND
private final BroadcastReceiver mReceiver = new BroadcastReceiver() {
    public void onReceive(Context context, Intent intent) {
        String action = intent.getAction();
        // When discovery finds a device
        if (BluetoothDevice.ACTION_FOUND.equals(action)) {
            // Filter out LE devices
            byte deviceType = intent.getByteExtra(BleAdapter.EXTRA_DEVICE_TYPE, BleAdapter.DEVICE_TYPE_BREDR);
            if (deviceType == BleAdapter.DEVICE_TYPE_BLE) {
                ...
            }
        }
    }
};</pre>

    <h3 id="ServiceDiscovery">Discovering Services</h3>

    <p>Low Energy profiles and services can be discovered using the Bluetooth service discovery process.
        The Open Bluetooth Lowe Energy APIs add a new function to perform service discovery on a
        remote Bluetooth device. To initiate service discovery, an application should call the
        <code><a href="com/broadcom/bt/le/api/BleAdapterhtml#getRemoteServices(java.lang.String)">BleAdapter.getRemoteServices()</a></code>
        method.</p>

    <p>The results of a remote device service discovery are broadcast using the
        <code><a href="com/broadcom/bt/le/api/BleAdapter.html#ACTION_UUID">BleAdapter.ACTION_UUID</a></code>
        intent.</p>

    <p>The following example illustrates the service discovery process:</p>

    <pre>// Create a BroadcastReceiver for ACTION_UUID
private final BroadcastReceiver mReceiver = new BroadcastReceiver() {
    public void onReceive(Context context, Intent intent) {
        String action = intent.getAction();
        // Evaluate service discovery result
        if (BleAdapter.ACTION_UUID.equals(action)) {
            Bundle bundle = intent.getExtras();
            Parcelable[] uuids = bundle.getParcelableArray(BleAdapter.EXTRA_UUID);
            for( int i = 0; i != uuids.length; ++i ) {
                ParcelUuid uuid = (ParcelUuid) uuids[i];
                // Access desired services
                ...
            }
        }
    }
};

...

// Start service discovery for a remote device (example Bluetooth address used)
BleAdatper.getRemoteServices("00:11:22:33:44:55");</pre>

    <h3 id="ClientProfile">Connect to a profile/service</h3>

    <p>In order to connect to a remote Bluetooth Low Energy Profile, an application must create and
        instantiate an instance of a <code><a href="com/broadcom/bt/le/api/BleClientProfile.html">BleClientProfile</a></code>
        class. Asides from implementing the callback functions of the
        <code><a href="com/broadcom/bt/le/api/BleClientProfile.html">BleClientProfile</a></code> class,
        any required and optional LE services that the profile uses must be specified when the new
        profile is initialized.</p>

    <p>Required and included LE services that are used by a profile are represented using the
        <code><a href="com/broadcom/bt/le/api/BleClientService.html">BleClientService</a></code>
        class.</p>

    <p>Once an application has sub-classed the desired LE services and profiles, the app may call the
        <code><a href="com/broadcom/bt/le/api/BleClientProfile.html#connect(BluetoothDevice)">connect()</a></code>
        function to initiate a connection to the remote device. Alternatively, the
        <code><a href="com/broadcom/bt/le/api/BleClientProfile.html#connectBackground(BluetoothDevice)">connectBackground()</a></code>
        function may be used to allow incoming connections from a LE device acting in the server role
        (ex. Bluetooth LE keyfob).<p>

    <p>The following example illustrates how an application may sub-class the
        <code><a href="com/broadcom/bt/le/api/BleClientService.html">BleClientService</a></code> and
        <code><a href="com/broadcom/bt/le/api/BleClientProfile.html">BleClientProfile</a></code>
        classes to access the Find Me LE profile and Immediate Alert LE service:</p>

    <p>- First, the required services are created - for this example, only the Immediate Alert service
        is required:</p>

    <pre>public class ImmediateAlertService extends BleClientService {
    // UUID from the Bluetooth Assigned Numbers
    static public BleGattID myUuid = new BleGattID("00001802-0000-1000-8000-00805f9b34fb");

    public ImmediateAlertService() {
        super(myUuid);
    }

    ...
}</pre>

    <p>- Now an app may create the FindMe profile and include the Immediate Alert service created
        above:</p>

    <pre>public class FindMeProfile extends BleClientProfile {
    // Unique UUID used to register the profile with the Bluetooth stack
    static BleGattID myUuid = new BleGattID("015f613f-fe1d-475b-b0da-dd947ead9c2d");

    // Service(s) used by this profile
    ImmediateAlertService mImmediateAlertService = new ImmediateAlertService();
    public ArrayList<BleClientService> mServices = new ArrayList<BleClientService>();

    // Constructor
    public FindMeProfile(Context ctxt) {
        super(ctxt, myUuid);

        mServices.add(mImmediateAlertService);
        init(mServices, null);
    }

    ...
}</pre>

    <p>- Finally, an application can instantiate the profile and connect to a remote device</p>

    <pre>// Get a Bluetooth device (samble Bluetooth Address used)
BluetoothDevice btDev = BluetoothAdapter.getDefaultAdapter().getRemoteDevice("00:11:22:33:44:55");

// Connect to the remote device
FindMeProfile mFindMeProfile = new FindMeProfile(this);
mFindMeProfile.connect(btDev);</pre>

    <p>A successful connection will trigger an
        <code><a href="com/broadcom/bt/le/api/BleClientProfile.html#onDeviceConnected(BluetoothDevice)">onDeviceConnected()</a></code>
        event.</p>

    <h3 id="ClientService">Reading and writing characteristics</h3>

    <p>Once a connection to a remote device has been established, an application may read or write
        remote characteristics according to the Bluetooth specifications.</p>

    <p>The
        <code><a href="com/broadcom/bt/le/api/BleClientProfile.html#refresh(BluetoothDevice)">refresh()</a></code>
        function can be used to enumerate and read all characteristics of the services included in
        a profile.</p>

    <p>Once refreshed, an application may access the characteristics and read or write values as needed:</p>

    <pre>public void onDeviceConnected(BluetoothDevice device) {
    // Refresh services and characteristics
    mFindMeProfile.refresh(device);
}

public void onRefreshed(BluetoothDevice device) {
    // Get the AlertLevel characteristic object from the service
    BleCharacteristic alertLevelCharacteristic =
                mImmediateAlertService.getCharacteristic(device, new BleGattID(ALERT_LEVEL_CHARACTERISTIC_UUID));

    // Assign a new value
    byte[] value = { FindMeProfileClient.ALERT_LEVEL_HIGH };
    alertLevelCharacteristic.setValue(value);

    // Write the characteristic
    mImmediateAlertService.writeCharacteristic(device, 0, alertLevelCharacteristic);
}</pre>

    <h2 id="ServerRole">Bluetooth LE server role</h2>

    <p>Similar to the way profiles and services are accessed in the client role, implementing a
        new Low Energy profile in the server role is done by extending and instantiating the abstract base classes
        <code><a href="com/broadcom/bt/le/api/BleServerService.html">BleServerService</a></code> and
        <code><a href="com/broadcom/bt/le/api/BleServerProfile.html">BleServerProfile</a></code>.</p>

    <h3 id="ServerService">Creating LE services</h3>

    <p>After deciding which LE profile and services to implement, an application may create the
        required and optional services by creating a class derived from
        <code><a href="com/broadcom/bt/le/api/BleServerService.html">BleServerService</a></code>.</p>

    <p>The <code><a href="com/broadcom/bt/le/api/BleServerService.html">BleServerService</a></code>
        class provides a variety of functions and callback methods that allow an application to
        manage service characteristics and receive callbacks when a remote client accesses
        a given attribute.</p>

    <p>To create a new LE service, an application must extend the
        <code><a href="com/broadcom/bt/le/api/BleServerService.html">BleServerService</a></code>
        class:</p>

    <pre>public class CurrentTimeService extends BleServerService {
    // Desired service UUID (see Bluetooth Assigned Numbers)
    private static final String SERVICE_UUID                     = "00001805-0000-1000-8000-00805f9b34fb";

    public CurrentTimeService() {
        super(new BleGattID(SERVICE_UUID), NUM_HANDLES);
    }

    ...
}</pre>

    <p>LE Characteristics are represented using the
        <code><a href="com/broadcom/bt/le/api/BleCharacteristic.html">BleCharacteristic</a></code>
        class. After creating a service, characteristics are added to a service as following:</p>

    <pre>private static final String CURRENT_TIME_CHARACTERISTIC_UUID = "00002a2b-0000-1000-8000-00805f9b34fb";

void addCurrentTimeCharacteristic() {
    // Create a new characteristic
    BleCharacteristic characteristic = new BleCharacteristic(new BleGattID(CURRENT_TIME_CHARACTERISTIC_UUID));
    characteristic.setProperty((byte) (BleConstants.GATT_CHAR_PROP_BIT_READ | BleConstants.GATT_CHAR_PROP_BIT_NOTIFY));
    characteristic.setPermMask(BleConstants.GATT_PERM_READ);

    // Add characteristic to this service
    addCharacteristic(characteristic);
}</pre>
    <p>The Bluetooth Low Energy API also allows an application to add characteristics with user
        defined descriptors. An application may use
        <code><a href="com/broadcom/bt/le/api/BleCharacteristic.html#addDescriptor(com.broadcom.bt.le.api.BleDescriptor)">addDescriptor()</a></code>
        and related functions to manage the descriptors for a given characteristic.</p>

    <p>Finally, an application must instantiate the created service and add the characteristics 
        once the profile hosting the service has been initialized:</p>

    <pre>public class TimeProfileServer extends BleServerProfile {
    public static TimeProfileServer createProfile(Context context) {
        CurrentTimeService service = new CurrentTimeService(context);
        ArrayList<BleServerService> services = new ArrayList<BleServerService>();
        services.add(service);
        return new TimeProfileServer(context, services);
    }

    ...

    public void onInitialized(boolean initialized) {
        mCurrentTimeService.addCurrentTimeCharacteristic();
        startProfile();
    }</pre>

    <p>The
        <code><a href="com/broadcom/bt/le/api/BleServerService.html#onCharacteristicAdded(byte, com.broadcom.bt.le.api.BleCharacteristic)">onCharacteristicAdded()</a></code>
        callback is invoked when characteristics are added to a service. An application may repeat
        the above steps to add as many characteristics as necessary or use the
        <code><a href="com/broadcom/bt/le/api/BleServerService.html#addIncludedService(com.broadcom.bt.le.api.BleServerService)">addIncludedService()</a></code>
        API to add any included services.</p>

    <h3 id="ServerProfile">Constructing an LE profile</h3>

    <p>Once an application has created all required and optional services for a given profile and
        added the desired characteristics, the services can be included in a LE profile.</p>

    <p>A new LE profile is assembled by creating and instantiating a sub-class of the
        <code><a href="com/broadcom/bt/le/api/BleServerProfile.html">BleServerProfile</a></code>
        class and including the previously created services:</p>

    <pre>public class ProximityProfile extends BleServerProfile {
    public  ProximityProfile(Context ctxt, BleGattID appId)
    {
        ArrayList<BleServerService> serviceArr = new ArrayList<BleServerService>();
        serviceArr.add(mLinkLossService);
        super(ctxt, appId, serviceArr);
    }

    ...
}</pre>

    <p>Once all profiles and services are created an application can initialize and start the profile:</p>

    <pre>ProximityProfile mProximityProfile = new ProximityProfile(ctxt,  appId);
...
mProximityProfile.startProfile()</pre>

    <p>The application is now ready to handle incoming read and write requests from remote clients.
        To handle characteristic read/write requests, an application may override the
        <code><a href="com/broadcom/bt/le/api/BleServerService.html#onCharacteristicRead(java.lang.String, int, int, com.broadcom.bt.le.api.BleCharacteristic)">onCharacteristicRead()</a></code>
        and <code><a href="com/broadcom/bt/le/api/BleServerService.html#onCharacteristicWrite(java.lang.String, com.broadcom.bt.le.api.BleCharacteristic)">onCharacteristicWrite()</a></code>
        methods. If the
        <code><a href="com/broadcom/bt/le/api/BleServerService.html#onCharacteristicRead(java.lang.String, int, int, com.broadcom.bt.le.api.BleCharacteristic)">onCharacteristicRead()</a></code>
        method is not overridden, the default behaviour is to return the value that is stored in the
        <code><a href="com/broadcom/bt/le/api/BleCharacteristic.html">BleCharacterisitic</a></code>
        object that was registered with the service.</p>

    <p>The following example illustrates how an application may handle an incoming read request:</p>

    <pre>void onCharacteristicRead(String address, int transId, BLECharacteristic charObj)
{
    // Get the current value
    mAlertLevel = getCurrentAlertLevel();
    charObj.setValue(mAlertLevel.getBytes());

    // Send a response to the client
    sendResponse(address, transId, charObj);
}</pre>

    <h3 id="ClientNotifications">Client Notifications</h3>

    <p>Bluetooth Low Energy clients may also register to be notified when a characteristic value
        changes.</p>

    <p>An application or service may monitor an internal state for example, and notify any
        registered clients when an alert level is reached:</p>

    <pre>// Example: Register a broadcast receiver that receives internal battery alerts
registerReceiver(mAlertLevelReceiver)

...

// Notify all clients by calling the BleServerService.updateCharacteristic() method
private final BroadcastReceiver mAlertLevelReceiver = new BroadcastReceiver() {
    public void onReceive(Context context, Intent intent) {
        String alertLevel = intent.getParcelableExtra(ALERT_LEVEL);
        alertChar.setValue(alertLevel.getBytes());
        mLinkLossService.updateCharacteristic(alertChar);
    }
}</pre>
</div>

<script src="js/jquery-resizable.min.js" type="text/javascript"></script>
<script src="js/prettify.js" type="text/javascript"></script>

<script type="text/javascript">
    function addLoadEvent(newfun) {
        var current = window.onload;
        if (typeof window.onload != 'function') {
            window.onload = newfun;
        } else {
            window.onload = function() {
            current();
            newfun();
            }
        }
    }

    addLoadEvent( function() {
        $("pre:not(.no-pretty-print)").addClass("prettyprint");
        prettyPrint();
    } );
</script>
<P>

<P>
<HR>


<!-- ======= START OF BOTTOM NAVBAR ====== -->
<A NAME="navbar_bottom"><!-- --></A>
<A HREF="#skip-navbar_bottom" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_bottom_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Overview</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="com/broadcom/bt/le/api/package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <FONT CLASS="NavBarFont1">Class</FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="overview-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;PREV&nbsp;
&nbsp;NEXT</FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="index.html?overview-summary.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="overview-summary.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_bottom"></A>
<!-- ======== END OF BOTTOM NAVBAR ======= -->

<HR>

</BODY>
</HTML>
